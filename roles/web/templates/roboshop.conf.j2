# Set the HTTP version to 1.1 for proxy communication
proxy_http_version 1.1;

# Serve images with caching and fallback to a placeholder image
location /images/ {
    expires 5s;
    root /usr/share/nginx/html;
    try_files $uri /images/placeholder.jpg;
}

# Proxy requests to catalogue service
location /api/catalogue/ {
    proxy_pass http://{{ CATALOGUE_HOST }}:8080/;
}

# Proxy requests to user service
location /api/user/ {
    proxy_pass http://{{ USER_HOST }}:8080/;
}

# Proxy requests to cart service
location /api/cart/ {
    proxy_pass http://{{ CART_HOST }}:8080/;
}

# Proxy requests to shipping service
location /api/shipping/ {
    proxy_pass http://{{ SHIPPING_HOST }}:8080/;
}

# Proxy requests to payment service
location /api/payment/ {
    proxy_pass http://{{ PAYMENT_HOST }}:8080/;
}

# Expose NGINX stub status for monitoring
location /health {
    stub_status on;
    access_log off;
}
